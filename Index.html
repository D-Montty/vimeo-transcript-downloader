<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vimeo Transcript Downloader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1 {
            color: #1ab7ea; /* Vimeo blue */
            text-align: center;
        }
        .container {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #1ab7ea; /* Vimeo blue */
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0d9fd3;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .error {
            background-color: #ffe6e6;
            color: #d63031;
            border-left: 4px solid #d63031;
        }
        .success {
            background-color: #e6ffe6;
            color: #2ecc71;
            border-left: 4px solid #2ecc71;
        }
        .info {
            background-color: #e6f7ff;
            color: #0984e3;
            border-left: 4px solid #0984e3;
        }
        .warning {
            background-color: #fff9e6;
            color: #f39c12;
            border-left: 4px solid #f39c12;
        }
        .hidden {
            display: none;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #1ab7ea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .instructions {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .instructions h3 {
            margin-top: 0;
        }
        .note {
            font-size: 0.9em;
            color: #666;
            margin-top: 10px;
        }
        .cors-warning {
            background-color: #fffbeb;
            border: 1px solid #fbbf24;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .tabs {
            display: flex;
            margin-top: 20px;
        }
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            background-color: #e9e9e9;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .tab.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
            position: relative;
            z-index: 1;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 0 5px 5px 5px;
            margin-top: -1px;
        }
        .tab-content.active {
            display: block;
        }
        .code-block {
            background-color: #f7f7f7;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: monospace;
            margin: 10px 0;
        }
        .alternatives {
            margin-top: 30px;
        }
        textarea {
            width: 100%;
            min-height: 200px;
            font-family: monospace;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h1>Vimeo Transcript Downloader</h1>
    
    <div class="cors-warning">
        <strong>⚠️ Important CORS Notice:</strong>
        <p>This tool makes cross-origin requests to Vimeo's API which are <strong>blocked by browsers when running locally</strong> due to CORS policy. To use this tool, you need to either:</p>
        <ol>
            <li>Host it on a web server with proper CORS headers</li>
            <li>Use a CORS proxy server</li>
            <li>Install a browser extension that disables CORS for local development</li>
            <li>Use the manual method in the "Manual Steps" tab</li>
        </ol>
    </div>
    
    <div class="tabs">
        <div class="tab active" data-tab="tool">Tool</div>
        <div class="tab" data-tab="cors-solution">CORS Solutions</div>
        <div class="tab" data-tab="manual">Manual Steps</div>
        <div class="tab" data-tab="node">Node.js Version</div>
    </div>
    
    <div id="tool" class="tab-content active">
        <div class="container">
            <div class="instructions">
                <h3>How to use:</h3>
                <ol>
                    <li>Paste a Vimeo video URL in the field below</li>
                    <li>Click "Download Transcript"</li>
                    <li>Wait for the tool to find and download the VTT file</li>
                </ol>
                <p class="note">Note: This tool only works with public videos that have captions available.</p>
            </div>
            
            <input type="text" id="vimeoUrl" placeholder="https://vimeo.com/123456789" />
            <button id="downloadBtn">Download Transcript</button>
            
            <div id="statusMessage" class="status hidden"></div>
        </div>
    </div>
    
    <div id="cors-solution" class="tab-content">
        <h3>Solving CORS Issues</h3>
        <p>There are several ways to bypass CORS restrictions for local development:</p>
        
        <h4>Option 1: Use a CORS Proxy</h4>
        <p>Update the fetch URLs in the code to use a CORS proxy like:</p>
        <div class="code-block">
            // Instead of:
            const response = await fetch(url);
            
            // Use:
            const response = await fetch(`https://cors-anywhere.herokuapp.com/${url}`);
            // OR
            const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
        </div>
        <p>Note: Public CORS proxies may have rate limits or require registration.</p>
        
        <h4>Option 2: Browser Extensions</h4>
        <p>Install a browser extension to disable CORS for development:</p>
        <ul>
            <li>Chrome: <a href="https://chrome.google.com/webstore/detail/allow-cors-access-control/lhobafahddgcelffkeicbaginigeejlf" target="_blank">Allow CORS: Access-Control-Allow-Origin</a></li>
            <li>Firefox: <a href="https://addons.mozilla.org/en-US/firefox/addon/cors-everywhere/" target="_blank">CORS Everywhere</a></li>
        </ul>
        
        <h4>Option 3: Host on a Server</h4>
        <p>Host this HTML file on a web server with proper CORS headers or using a solution like GitHub Pages.</p>
    </div>
    
    <div id="manual" class="tab-content">
        <h3>Manual Steps to Get Vimeo Transcripts</h3>
        <p>If the automated tool doesn't work due to CORS issues, follow these manual steps:</p>
        
        <ol>
            <li>Open your Vimeo video page (e.g., https://vimeo.com/123456789)</li>
            <li>Right-click on the page and select "View Page Source" or press Ctrl+U</li>
            <li>In the source code, search (Ctrl+F) for "text_tracks"</li>
            <li>Look for JSON data that contains "text_tracks" with URLs ending in ".vtt"</li>
            <li>Copy the VTT URL (it will look like https://vimeo.com/texttrack/...)
            <li>Open the URL in a new browser tab</li>
            <li>Right-click and select "Save as..." to save the VTT file</li>
        </ol>
        
        <h4>Alternative Method using Developer Tools</h4>
        <ol>
            <li>Open your Vimeo video in the browser</li>
            <li>Open Developer Tools (F12 or right-click → Inspect)</li>
            <li>Go to the Network tab</li>
            <li>Play the video with captions enabled</li>
            <li>Filter for "vtt" in the network requests</li>
            <li>Find the VTT file request, right-click and select "Open in new tab"</li>
            <li>Save the file from the new tab</li>
        </ol>
    </div>
    
    <div id="node" class="tab-content">
        <h3>Node.js Version (No CORS Issues)</h3>
        <p>Here's a Node.js script that avoids CORS issues. Save this as <code>vimeo-transcript-downloader.js</code>:</p>
        
        <textarea id="nodeScript" readonly>
const https = require('https');
const fs = require('fs');
const path = require('path');

// Function to extract Vimeo ID from URL
function extractVimeoId(url) {
    const patterns = [
        /vimeo\.com\/(\d+)/,
        /vimeo\.com\/.*?\/(\d+)/,
        /player\.vimeo\.com\/video\/(\d+)/
    ];
    
    for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match && match[1]) {
            return match[1];
        }
    }
    
    return null;
}

// Function to make HTTP requests
function makeRequest(url) {
    return new Promise((resolve, reject) => {
        https.get(url, (response) => {
            if (response.statusCode !== 200) {
                reject(new Error(`Request failed with status code ${response.statusCode}`));
                return;
            }
            
            let data = '';
            response.on('data', (chunk) => {
                data += chunk;
            });
            
            response.on('end', () => {
                resolve(data);
            });
        }).on('error', (error) => {
            reject(error);
        });
    });
}

// Main function to download transcript
async function downloadTranscript(videoUrl) {
    try {
        // Extract video ID
        const videoId = extractVimeoId(videoUrl);
        if (!videoId) {
            console.error('Invalid Vimeo URL');
            return;
        }
        
        console.log(`Processing Vimeo video ID: ${videoId}`);
        
        // Get video page content
        const videoPageUrl = `https://player.vimeo.com/video/${videoId}`;
        console.log('Fetching video page...');
        const videoPageContent = await makeRequest(videoPageUrl);
        
        // Extract player config
        const configMatch = videoPageContent.match(/window\.playerConfig\s*=\s*({.+?});/);
        if (!configMatch || !configMatch[1]) {
            console.error('Could not find player configuration');
            return;
        }
        
        // Parse player config
        const playerConfig = JSON.parse(configMatch[1]);
        
        // Look for text tracks
        const textTracks = playerConfig.request?.text_tracks || playerConfig.video?.text_tracks;
        
        if (!textTracks || textTracks.length === 0) {
            console.error('No transcript found for this video');
            return;
        }
        
        // Find the English transcript or take the first available
        const transcript = textTracks.find(track => track.lang === 'en') || textTracks[0];
        
        // Get the VTT URL
        const vttUrl = transcript.url;
        if (!vttUrl) {
            console.error('Transcript URL not found');
            return;
        }
        
        // Download the VTT content
        console.log(`Downloading transcript in ${transcript.lang} language...`);
        const vttContent = await makeRequest(vttUrl);
        
        // Save to file
        const fileName = `vimeo_${videoId}_${transcript.lang || 'transcript'}.vtt`;
        fs.writeFileSync(fileName, vttContent);
        
        console.log(`Transcript saved to ${fileName}`);
    } catch (error) {
        console.error('Error:', error.message);
    }
}

// Check if URL is provided as command line argument
const videoUrl = process.argv[2];
if (!videoUrl) {
    console.log('Usage: node vimeo-transcript-downloader.js VIMEO_URL');
} else {
    downloadTranscript(videoUrl);
}
        </textarea>
        
        <h4>How to use the Node.js version:</h4>
        <ol>
            <li>Install Node.js if you don't have it: <a href="https://nodejs.org/" target="_blank">https://nodejs.org/</a></li>
            <li>Save the code above as <code>vimeo-transcript-downloader.js</code></li>
            <li>Open a terminal/command prompt in the same directory</li>
            <li>Run: <code>node vimeo-transcript-downloader.js https://vimeo.com/YOUR_VIDEO_ID</code></li>
            <li>The VTT file will be saved in the same directory</li>
        </ol>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlInput = document.getElementById('vimeoUrl');
            const downloadBtn = document.getElementById('downloadBtn');
            const statusMessage = document.getElementById('statusMessage');
            
            // Tab functionality
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Hide all tab contents
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Remove active class from all tabs
                    tabs.forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    // Activate clicked tab
                    tab.classList.add('active');
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            downloadBtn.addEventListener('click', async () => {
                // Clear previous status
                statusMessage.className = 'status hidden';
                
                const url = urlInput.value.trim();
                if (!url) {
                    showStatus('Please enter a Vimeo URL', 'error');
                    return;
                }
                
                // Extract Vimeo ID from URL
                const vimeoId = extractVimeoId(url);
                if (!vimeoId) {
                    showStatus('Invalid Vimeo URL. Please enter a valid Vimeo video link.', 'error');
                    return;
                }
                
                // Show loading state
                downloadBtn.disabled = true;
                showStatus('<div class="loader"></div> Attempting to fetch transcript...', 'info');
                
                try {
                    await downloadTranscript(vimeoId);
                } catch (error) {
                    if (error.message.includes('Failed to fetch') || error.name === 'TypeError') {
                        showStatus(`CORS Error: The browser blocked the request due to cross-origin restrictions. Please try one of the solutions in the "CORS Solutions" tab or use the "Manual Steps" approach.`, 'warning');
                    } else {
                        showStatus(`Error: ${error.message}`, 'error');
                    }
                } finally {
                    downloadBtn.disabled = false;
                }
            });
            
            function extractVimeoId(url) {
                // Match patterns like:
                // https://vimeo.com/123456789
                // https://player.vimeo.com/video/123456789
                // https://vimeo.com/channels/staffpicks/123456789
                const patterns = [
                    /vimeo\.com\/(\d+)/,
                    /vimeo\.com\/.*?\/(\d+)/,
                    /player\.vimeo\.com\/video\/(\d+)/
                ];
                
                for (const pattern of patterns) {
                    const match = url.match(pattern);
                    if (match && match[1]) {
                        return match[1];
                    }
                }
                
                return null;
            }
            
            async function downloadTranscript(videoId) {
                // First, we need to get the video's metadata to find the text tracks
                showStatus('<div class="loader"></div> Fetching video metadata...', 'info');
                
                try {
                    // Using the Vimeo oEmbed API which is public and doesn't require authentication
                    const oEmbedUrl = `https://vimeo.com/api/oembed.json?url=https://vimeo.com/${videoId}`;
                    
                    // Try with a CORS proxy as a fallback option
                    let oEmbedResponse;
                    try {
                        oEmbedResponse = await fetch(oEmbedUrl);
                    } catch (corsError) {
                        // If direct fetch fails due to CORS, try with a proxy
                        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(oEmbedUrl)}`;
                        showStatus('<div class="loader"></div> Direct request failed. Trying with CORS proxy...', 'info');
                        oEmbedResponse = await fetch(proxyUrl);
                    }
                    
                    if (!oEmbedResponse.ok) {
                        throw new Error('Failed to fetch video metadata. Video might be private or does not exist.');
                    }
                    
                    const oEmbedData = await oEmbedResponse.json();
                    
                    // Now, we need to get the video configuration that contains text tracks
                    showStatus('<div class="loader"></div> Looking for transcript data...', 'info');
                    
                    // We need to fetch the video page to extract the player config
                    const videoPageUrl = `https://player.vimeo.com/video/${videoId}`;
                    
                    // Try direct fetch first, then fallback to proxy
                    let videoPageResponse;
                    try {
                        videoPageResponse = await fetch(videoPageUrl);
                    } catch (corsError) {
                        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(videoPageUrl)}`;
                        showStatus('<div class="loader"></div> Using CORS proxy to fetch video page...', 'info');
                        videoPageResponse = await fetch(proxyUrl);
                    }
                    
                    if (!videoPageResponse.ok) {
                        throw new Error('Failed to access video page.');
                    }
                    
                    const videoPageText = await videoPageResponse.text();
                    
                    // Extract the config JSON